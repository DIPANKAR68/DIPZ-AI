<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dipz AI</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:ital,wght@0,400;0,500;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #111118;
    --surface2: #1a1a24;
    --border: #252535;
    --accent: #7c6af7;
    --accent2: #f76a8a;
    --text: #e8e8f0;
    --text-muted: #6b6b85;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    height: 100vh;
    display: flex;
    overflow: hidden;
  }

  /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
  .sidebar {
    width: 272px;
    background: var(--surface);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    padding: 20px 14px 0;
    flex-shrink: 0;
    overflow: hidden;
  }
  .logo {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 22px;
    margin-bottom: 22px;
    padding: 0 6px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .logo-icon {
    width: 32px; height: 32px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
  }
  .logo span { background: linear-gradient(90deg, var(--accent), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

  .new-chat-btn {
    background: linear-gradient(135deg, var(--accent), #5a4ee0);
    color: white; border: none; border-radius: 10px;
    padding: 10px 16px; font-family: 'DM Sans', sans-serif;
    font-size: 14px; font-weight: 500; cursor: pointer;
    display: flex; align-items: center; gap: 8px;
    margin-bottom: 18px; transition: opacity .2s, transform .15s;
  }
  .new-chat-btn:hover { opacity: .85; transform: translateY(-1px); }

  .section-label {
    font-size: 10px; font-weight: 700; letter-spacing: 1.4px;
    text-transform: uppercase; color: var(--text-muted);
    padding: 0 6px; margin-bottom: 7px;
  }

  .history-list { flex: 1; overflow-y: auto; min-height: 0; }
  .history-list::-webkit-scrollbar { width: 0; }
  .history-item {
    padding: 9px 10px; border-radius: 8px; font-size: 13px;
    color: var(--text-muted); cursor: pointer;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    transition: background .15s, color .15s;
  }
  .history-item:hover { background: var(--surface2); color: var(--text); }

  /* API Section */
  .api-section {
    margin-top: 10px; padding: 13px 0 0;
    border-top: 1px solid var(--border);
  }
  .api-input-wrap { position: relative; }
  .api-input {
    width: 100%; background: var(--surface2);
    border: 1px solid var(--border); border-radius: 8px;
    padding: 9px 44px 9px 10px; color: var(--text);
    font-size: 12px; font-family: 'DM Mono', monospace; outline: none;
    transition: border-color .2s;
  }
  .api-input:focus { border-color: var(--accent); }
  .api-input::placeholder { color: var(--text-muted); }
  .api-save-btn {
    position: absolute; right: 6px; top: 50%; transform: translateY(-50%);
    background: var(--accent); border: none; border-radius: 5px;
    color: white; font-size: 11px; padding: 3px 7px; cursor: pointer;
    font-family: 'DM Sans', sans-serif; font-weight: 500;
  }
  .api-status { font-size: 11px; margin-top: 5px; }
  .api-status.ok { color: #5de8a0; }
  .api-status.err { color: var(--accent2); }

  /* Public Key Box */
  .pk-box {
    margin-top: 11px;
    background: linear-gradient(135deg, rgba(124,106,247,.1), rgba(247,106,138,.07));
    border: 1px solid rgba(124,106,247,.3);
    border-radius: 10px; padding: 10px 12px;
  }
  .pk-label {
    font-size: 10px; font-weight: 700; letter-spacing: .8px;
    text-transform: uppercase; color: var(--accent); margin-bottom: 6px;
  }
  .pk-value {
    font-family: 'DM Mono', monospace; font-size: 10.5px; color: #b4a7ff;
    line-height: 1.55; word-break: break-all; user-select: all;
  }
  .pk-actions { display: flex; gap: 6px; margin-top: 8px; }
  .pk-btn {
    flex: 1; border-radius: 6px; font-size: 11px;
    font-family: 'DM Sans', sans-serif; font-weight: 500;
    padding: 5px 8px; cursor: pointer;
    display: flex; align-items: center; gap: 4px; justify-content: center;
    transition: background .2s;
  }
  .pk-copy {
    background: rgba(124,106,247,.2); border: 1px solid rgba(124,106,247,.4); color: var(--accent);
  }
  .pk-copy:hover { background: rgba(124,106,247,.35); }
  .pk-use {
    background: rgba(93,232,160,.1); border: 1px solid rgba(93,232,160,.3); color: #5de8a0;
  }
  .pk-use:hover { background: rgba(93,232,160,.2); }

  /* Credits */
  .credits { padding: 12px 0 16px; border-top: 1px solid var(--border); margin-top: 11px; }
  .credits-card {
    display: flex; align-items: center; gap: 10px;
    padding: 10px; border-radius: 10px; background: var(--surface2);
  }
  .credits-av {
    width: 36px; height: 36px; border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex; align-items: center; justify-content: center;
    font-family: 'Syne', sans-serif; font-size: 12px; font-weight: 700;
    color: white; flex-shrink: 0;
  }
  .credits-made { font-size: 10px; color: var(--text-muted); margin-bottom: 1px; }
  .credits-name { font-size: 13px; font-weight: 600; font-family: 'Syne', sans-serif; color: var(--text); }
  .credits-link {
    font-size: 11px; color: var(--accent); text-decoration: none;
    display: inline-flex; align-items: center; gap: 3px; margin-top: 2px;
    transition: color .2s;
  }
  .credits-link:hover { color: var(--accent2); }

  /* ‚îÄ‚îÄ Main ‚îÄ‚îÄ */
  .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

  .topbar {
    display: flex; align-items: center; justify-content: space-between;
    padding: 13px 24px; border-bottom: 1px solid var(--border);
    background: var(--surface); flex-shrink: 0;
  }
  .model-select {
    background: var(--surface2); border: 1px solid var(--border);
    color: var(--text); border-radius: 8px; padding: 7px 12px;
    font-family: 'DM Sans', sans-serif; font-size: 13px; outline: none; cursor: pointer;
  }
  .topbar-brand {
    font-family: 'Syne', sans-serif; font-weight: 800; font-size: 17px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }

  /* Chat */
  .chat-area { flex: 1; overflow-y: auto; padding: 32px 0; scroll-behavior: smooth; }
  .chat-area::-webkit-scrollbar { width: 4px; }
  .chat-area::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  /* Welcome */
  .welcome {
    display: flex; flex-direction: column; align-items: center;
    justify-content: center; height: 100%; gap: 14px;
    text-align: center; padding: 40px; animation: fadeUp .5s ease;
  }
  .welcome-icon {
    width: 70px; height: 70px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 20px; display: flex; align-items: center; justify-content: center;
    font-size: 34px; margin-bottom: 6px;
    box-shadow: 0 0 40px rgba(124,106,247,.3);
  }
  .welcome h1 {
    font-family: 'Syne', sans-serif; font-size: 32px; font-weight: 800;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .welcome p { color: var(--text-muted); font-size: 15px; max-width: 420px; line-height: 1.65; }
  .welcome-by { font-size: 12px; color: var(--text-muted); }
  .welcome-by a { color: var(--accent); text-decoration: none; font-weight: 500; }
  .welcome-by a:hover { color: var(--accent2); }

  .suggestions {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 10px; margin-top: 16px; max-width: 520px; width: 100%;
  }
  .suggestion-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 14px 16px; cursor: pointer;
    text-align: left; font-size: 13px; color: var(--text-muted);
    transition: border-color .2s, color .2s, transform .15s; line-height: 1.5;
  }
  .suggestion-card:hover { border-color: var(--accent); color: var(--text); transform: translateY(-2px); }
  .suggestion-card strong { display: block; font-size: 14px; color: var(--text); margin-bottom: 3px; font-weight: 500; }

  /* Messages */
  .message-group { max-width: 760px; margin: 0 auto; padding: 0 24px; animation: fadeUp .3s ease; }
  .message { display: flex; gap: 14px; padding: 18px 0; border-bottom: 1px solid rgba(255,255,255,.04); }
  .avatar {
    width: 34px; height: 34px; border-radius: 9px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; flex-shrink: 0; margin-top: 2px;
  }
  .avatar.user { background: linear-gradient(135deg, #3a3a5c, #252540); }
  .avatar.ai { background: linear-gradient(135deg, var(--accent), var(--accent2)); }
  .msg-content { flex: 1; line-height: 1.75; font-size: 15px; }
  .msg-role { font-size: 11px; font-weight: 700; letter-spacing: .7px; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; }
  .msg-text { color: var(--text); }
  .msg-text p { margin-bottom: 10px; }
  .msg-text p:last-child { margin-bottom: 0; }
  .msg-text code { background: var(--surface2); border: 1px solid var(--border); border-radius: 5px; padding: 2px 6px; font-family: 'DM Mono', monospace; font-size: 13px; color: #b4a7ff; }
  .msg-text pre { background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 16px; margin: 12px 0; overflow-x: auto; }
  .msg-text pre code { background: none; border: none; padding: 0; color: #c8c0ff; }
  .msg-text ul, .msg-text ol { padding-left: 20px; margin-bottom: 10px; }
  .msg-text li { margin-bottom: 4px; }

  /* Typing */
  .typing { display: flex; gap: 5px; align-items: center; padding: 8px 0; }
  .typing span { width: 7px; height: 7px; background: var(--accent); border-radius: 50%; animation: bounce 1.2s infinite; }
  .typing span:nth-child(2) { animation-delay: .2s; }
  .typing span:nth-child(3) { animation-delay: .4s; }
  @keyframes bounce { 0%,80%,100%{transform:scale(.6);opacity:.4}40%{transform:scale(1);opacity:1} }

  /* Input */
  .input-area { padding: 14px 24px 20px; background: var(--bg); flex-shrink: 0; }
  .input-wrap {
    max-width: 760px; margin: 0 auto; position: relative;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 14px; transition: border-color .2s, box-shadow .2s;
  }
  .input-wrap:focus-within { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(124,106,247,.15); }
  #messageInput {
    width: 100%; background: transparent; border: none; outline: none;
    padding: 15px 58px 15px 18px; color: var(--text);
    font-family: 'DM Sans', sans-serif; font-size: 15px;
    resize: none; max-height: 200px; line-height: 1.5;
  }
  #messageInput::placeholder { color: var(--text-muted); }
  .send-btn {
    position: absolute; right: 10px; bottom: 9px;
    width: 38px; height: 38px;
    background: linear-gradient(135deg, var(--accent), #5a4ee0);
    border: none; border-radius: 9px; color: white; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: opacity .2s, transform .15s;
  }
  .send-btn:hover { opacity: .85; transform: scale(1.05); }
  .send-btn:disabled { opacity: .4; cursor: not-allowed; transform: none; }
  .input-footer {
    max-width: 760px; margin: 8px auto 0;
    font-size: 11px; color: var(--text-muted); text-align: center;
  }
  .input-footer a { color: var(--accent); text-decoration: none; }
  .input-footer a:hover { color: var(--accent2); }

  @keyframes fadeUp { from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)} }

  @media(max-width:640px){ .sidebar{display:none} .suggestions{grid-template-columns:1fr} }

  /* Toast */
  .toast {
    position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%);
    padding: 10px 20px; border-radius: 10px; font-size: 13px;
    z-index: 999; animation: fadeUp .3s ease; white-space: nowrap;
  }
  .toast.err { background: #3a1a22; border: 1px solid var(--accent2); color: var(--accent2); }
  .toast.ok { background: #0f2a1e; border: 1px solid #5de8a0; color: #5de8a0; }
</style>
</head>
<body>

<!-- Sidebar -->
<aside class="sidebar">
  <div class="logo">
    <div class="logo-icon">‚ö°</div>
    <span>Dipz AI</span>
  </div>

  <button class="new-chat-btn" onclick="newChat()">
    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
    New Chat
  </button>

  <div class="section-label">Recent Chats</div>
  <div class="history-list" id="historyList"></div>

  <!-- API Key -->
  <div class="api-section">
    <div class="section-label">Your API Key</div>
    <div class="api-input-wrap">
      <input type="password" class="api-input" id="apiKeyInput" placeholder="sk-ant-..." />
      <button class="api-save-btn" onclick="saveApiKey()">Save</button>
    </div>
    <div class="api-status ok" id="apiStatus">‚úì Public key active</div>

    <!-- Public Key Box -->
    <div class="pk-box">
      <div class="pk-label">üîë Free Public Key ‚Äî copy &amp; use!</div>
      <div class="pk-value" id="pkDisplay">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</div>
      <div class="pk-actions">
        <button class="pk-btn pk-copy" onclick="copyPublicKey()">
          <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
          Copy Key
        </button>
        <button class="pk-btn pk-use" onclick="usePublicKey()">‚úì Use It</button>
      </div>
    </div>
  </div>

  <!-- Credits -->
  <div class="credits">
    <div class="credits-card">
      <div class="credits-av">DM</div>
      <div>
        <div class="credits-made">Made with ‚ù§Ô∏è by</div>
        <div class="credits-name">Dipankar Mandal</div>
        <a href="https://dipankar68.github.io/portfolio/" target="_blank" class="credits-link">
          <svg width="11" height="11" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"/></svg>
          Portfolio ‚Üó
        </a>
      </div>
    </div>
  </div>
</aside>

<!-- Main -->
<main class="main">
  <div class="topbar">
    <select class="model-select" id="modelSelect">
      <option value="claude-opus-4-6">Claude Opus 4.6</option>
      <option value="claude-sonnet-4-6" selected>Claude Sonnet 4.6</option>
      <option value="claude-haiku-4-5-20251001">Claude Haiku 4.5</option>
    </select>
    <div class="topbar-brand">Dipz AI</div>
  </div>

  <div class="chat-area" id="chatArea">
    <div class="welcome" id="welcome">
      <div class="welcome-icon">‚ö°</div>
      <h1>Dipz AI</h1>
      <p>Your intelligent AI assistant powered by Claude. Ask anything ‚Äî coding, writing, analysis, and more.</p>
      <div class="welcome-by">Built by <a href="https://dipankar68.github.io/portfolio/" target="_blank">Dipankar Mandal</a></div>
      <div class="suggestions">
        <div class="suggestion-card" onclick="sendSuggestion('Explain quantum computing in simple terms')">
          <strong>üî¨ Science</strong>Explain quantum computing in simple terms
        </div>
        <div class="suggestion-card" onclick="sendSuggestion('Write a Python function to sort a list of dicts by a key')">
          <strong>üíª Code</strong>Write a Python function to sort dicts by key
        </div>
        <div class="suggestion-card" onclick="sendSuggestion('Help me write a professional email declining a job offer')">
          <strong>‚úçÔ∏è Writing</strong>Write a professional email declining an offer
        </div>
        <div class="suggestion-card" onclick="sendSuggestion('What are some creative date night ideas for couples at home?')">
          <strong>üí° Ideas</strong>Creative date night ideas for couples at home
        </div>
      </div>
    </div>
    <div id="messages"></div>
  </div>

  <div class="input-area">
    <div class="input-wrap">
      <textarea id="messageInput" placeholder="Message Dipz AI‚Ä¶" rows="1" onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
      <button class="send-btn" id="sendBtn" onclick="sendMessage()">
        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
      </button>
    </div>
    <div class="input-footer">
      Dipz AI ¬∑ Made by <a href="https://dipankar68.github.io/portfolio/" target="_blank">Dipankar Mandal</a> ¬∑ Powered by Anthropic Claude
    </div>
  </div>
</main>

<script>
  const PUBLIC_KEY = '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';

  let conversations = [];
  let currentConvo = [];
  let isLoading = false;
  let apiKey = localStorage.getItem('dipz_api_key') || PUBLIC_KEY;

  // Init
  (function init() {
    document.getElementById('apiKeyInput').value = apiKey;
    document.getElementById('apiStatus').textContent =
      apiKey === PUBLIC_KEY ? '‚úì Public key active' : '‚úì Custom key saved';
    document.getElementById('apiStatus').className = 'api-status ok';
  })();

  function saveApiKey() {
    const k = document.getElementById('apiKeyInput').value.trim();
    if (!k) return;
    apiKey = k;
    localStorage.setItem('dipz_api_key', k);
    document.getElementById('apiStatus').textContent = '‚úì API key saved';
    document.getElementById('apiStatus').className = 'api-status ok';
    showToast('API key saved!', 'ok');
  }

  function copyPublicKey() {
    navigator.clipboard.writeText(PUBLIC_KEY).then(() => {
      showToast('‚úì Public key copied to clipboard!', 'ok');
    }).catch(() => {
      // fallback: select the text
      const el = document.getElementById('pkDisplay');
      const range = document.createRange();
      range.selectNodeContents(el);
      window.getSelection().removeAllRanges();
      window.getSelection().addRange(range);
      showToast('Key selected ‚Äî press Ctrl+C / Cmd+C to copy', 'ok');
    });
  }

  function usePublicKey() {
    apiKey = PUBLIC_KEY;
    localStorage.setItem('dipz_api_key', PUBLIC_KEY);
    document.getElementById('apiKeyInput').value = PUBLIC_KEY;
    document.getElementById('apiStatus').textContent = '‚úì Public key active';
    document.getElementById('apiStatus').className = 'api-status ok';
    showToast('‚úì Now using the public key!', 'ok');
  }

  function autoResize(el) {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, 200) + 'px';
  }

  function handleKey(e) {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
  }

  function newChat() {
    if (currentConvo.length > 0) {
      const preview = currentConvo[0]?.content?.slice(0, 46) || 'Chat';
      conversations.unshift({ preview, messages: [...currentConvo] });
      renderHistory();
    }
    currentConvo = [];
    document.getElementById('messages').innerHTML = '';
    document.getElementById('welcome').style.display = 'flex';
  }

  function renderHistory() {
    document.getElementById('historyList').innerHTML = conversations.slice(0, 20)
      .map((c, i) => `<div class="history-item" onclick="loadConvo(${i})">${c.preview}‚Ä¶</div>`).join('');
  }

  function loadConvo(i) {
    currentConvo = [...conversations[i].messages];
    document.getElementById('welcome').style.display = 'none';
    document.getElementById('messages').innerHTML = '';
    currentConvo.forEach(m => appendMessage(m.role, m.content, false));
  }

  function sendSuggestion(t) {
    document.getElementById('messageInput').value = t;
    sendMessage();
  }

  async function sendMessage() {
    if (isLoading) return;
    const input = document.getElementById('messageInput');
    const text = input.value.trim();
    if (!text) return;

    document.getElementById('welcome').style.display = 'none';
    input.value = ''; input.style.height = 'auto';

    appendMessage('user', text);
    currentConvo.push({ role: 'user', content: text });

    isLoading = true;
    document.getElementById('sendBtn').disabled = true;
    const typingEl = showTyping();

    try {
      const model = document.getElementById('modelSelect').value;
      const res = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': apiKey,
          'anthropic-version': '2023-06-01',
          'anthropic-dangerous-direct-browser-access': 'true'
        },
        body: JSON.stringify({ model, max_tokens: 2048, messages: currentConvo })
      });

      typingEl.remove();

      if (!res.ok) {
        const err = await res.json();
        throw new Error(err.error?.message || `HTTP ${res.status}`);
      }

      const data = await res.json();
      const reply = data.content[0].text;
      currentConvo.push({ role: 'assistant', content: reply });
      appendMessage('assistant', reply);

    } catch (err) {
      typingEl.remove();
      showToast('Error: ' + err.message, 'err');
    }

    isLoading = false;
    document.getElementById('sendBtn').disabled = false;
    input.focus();
  }

  function appendMessage(role, content, animate = true) {
    const wrap = document.getElementById('messages');
    const div = document.createElement('div');
    div.className = 'message-group';
    if (!animate) div.style.animation = 'none';
    const isUser = role === 'user';
    div.innerHTML = `
      <div class="message">
        <div class="avatar ${isUser ? 'user' : 'ai'}">${isUser ? 'üë§' : '‚ö°'}</div>
        <div class="msg-content">
          <div class="msg-role">${isUser ? 'You' : 'Dipz AI'}</div>
          <div class="msg-text">${fmt(content)}</div>
        </div>
      </div>`;
    wrap.appendChild(div);
    div.scrollIntoView({ behavior: 'smooth', block: 'end' });
  }

  function fmt(t) {
    t = t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    t = t.replace(/```[\w]*\n?([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
    t = t.replace(/`([^`]+)`/g, '<code>$1</code>');
    t = t.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    t = t.replace(/\*(.+?)\*/g, '<em>$1</em>');
    return t.split(/\n\n+/).map(b => {
      if (b.startsWith('<pre>') || b.startsWith('<ul>')) return b;
      return `<p>${b.replace(/\n/g,'<br>')}</p>`;
    }).join('');
  }

  function showTyping() {
    const wrap = document.getElementById('messages');
    const div = document.createElement('div');
    div.className = 'message-group';
    div.innerHTML = `
      <div class="message">
        <div class="avatar ai">‚ö°</div>
        <div class="msg-content">
          <div class="msg-role">Dipz AI</div>
          <div class="typing"><span></span><span></span><span></span></div>
        </div>
      </div>`;
    wrap.appendChild(div);
    div.scrollIntoView({ behavior: 'smooth', block: 'end' });
    return div;
  }

  function showToast(msg, type = 'ok') {
    document.querySelector('.toast')?.remove();
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 3500);
  }
</script>
</body>
</html>
